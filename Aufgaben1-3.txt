--A 1.1
SELECT * FROM TEILESTAMM;

--A 1.2
SELECT * FROM TEILESTAMM WHERE LOWER(BEZEICHNUNG) LIKE '%city%';

--A 1.3
SELECT * FROM AUFTRAGSPOSTEN ORDER BY (ANZAHL*GESAMTPREIS) DESC
FETCH FIRST 1 ROW ONLY;

--A 1.4
SELECT COUNT(*) FROM KUNDE;
SELECT COUNT(*) FROM PERSONAL;
SELECT COUNT(*) FROM TEILESTAMM;

--A 1.5
SELECT MIN(DATUM) AS von, MAX(DATUM) AS bis FROM AUFTRAG;

--A 1.6
--SELECT * FROM AUFTRAG WHERE AUFTRNR = 2; --AUFTRAG 2: KUNDNR:3 - --PERSNR:5
--SELECT * FROM KUNDE WHERE NR = 3; --Maier Ingrid
--SELECT NAME FROM PERSONAL WHERE PERSNR = 5; --Johanna Kï¿½ster

SELECT NAME FROM PERSONAL WHERE  PERSNR =
	(SELECT VORGESETZT FROM PERSONAL WHERE NAME =
		(SELECT NAME FROM PERSONAL WHERE PERSNR = 5));

--A 1.7
SELECT * FROM LAGER WHERE BESTAND >= 1 ORDER BY BESTAND;

--A 1.8
SELECT DISTINCT TEILNR FROM LIEFERUNG ORDER BY TEILNR DESC;

--A 1.9
SELECT TEILNR AS teilenummer, BEZEICHNUNG AS bezeichnung, PREIS AS bruttopreis FROM TEILESTAMM
	WHERE PREIS > 30;

--A 1.10
SELECT TEILNR FROM LAGER WHERE TEILNR = ANY
	(SELECT EINZELTEILNR FROM TEILESTRUKTUR WHERE OBERTEILNR = 300001)
	AND RESERVIERT > 100;





--A 2.1
SELECT AUFTRNR, DATUM  FROM AUFTRAG WHERE KUNDNR IN
	(SELECT NR FROM KUNDE WHERE NAME = 'Fahrrad Shop');

--A 2.2
SELECT AUFTRNR, DATUM  FROM AUFTRAG WHERE KUNDNR = SOME
	(SELECT NR FROM KUNDE WHERE NAME = 'Fahrrad Shop');

--A 2.3
SELECT AUFTRNR, DATUM  FROM AUFTRAG WHERE EXISTS
	(SELECT * FROM KUNDE WHERE AUFTRAG.AUFTRNR = NR AND NAME = 'Fahrrad Shop' );

--A 2.4
SELECT KUNDNR, COUNT(KUNDNR) AS ANZAHL,
	MIN(DATUM) AS von, MAX(DATUM) AS bis
	FROM AUFTRAG GROUP BY KUNDNR ORDER BY KUNDNR;

--A 2.5
SELECT KUNDNR, COUNT(KUNDNR) AS ANZAHL,
	MIN(DATUM) AS von, MAX(DATUM) AS bis
	FROM AUFTRAG GROUP BY KUNDNR HAVING COUNT(KUNDNR) = 1
	ORDER BY KUNDNR;

--A 2.6
SELECT k.NR, k.NAME, a.AUFTRNR FROM KUNDE k
	JOIN AUFTRAG a ON k.NR = a.KUNDNR
	ORDER BY k.NR;
--oder
SELECT NR, NAME, AUFTRNR FROM KUNDE
	JOIN AUFTRAG ON NR = KUNDNR
	ORDER BY NR;

--A 2.7
SELECT k.NR, k.NAME, a.AUFTRNR, p.NAME  FROM KUNDE k
	INNER JOIN AUFTRAG a ON k.NR = a.KUNDNR
	INNER JOIN PERSONAL p  ON p.PERSNR = a.PERSNR
	ORDER BY k.NR;

--A 2.8
SELECT k.NAME, SUM(a.GESAMTPREIS)AS GESAMTPREIS  FROM KUNDE k
	INNER JOIN AUFTRAG a2 ON k.NR = a2.KUNDNR
	INNER JOIN AUFTRAGSPOSTEN a ON a2.AUFTRNR = a.AUFTRNR
	GROUP BY k.NAME
	ORDER BY GESAMTPREIS DESC
	FETCH FIRST 1 ROW ONLY;

--A 2.9
WITH temp AS(
	SELECT k.NAME, SUM(a.GESAMTPREIS)AS GESAMTPREIS  FROM KUNDE k
	INNER JOIN AUFTRAG a2 ON k.NR = a2.KUNDNR
	INNER JOIN AUFTRAGSPOSTEN a ON a2.AUFTRNR = a.AUFTRNR
	GROUP BY k.NAME
	)
	SELECT NAME, GESAMTPREIS FROM temp
	ORDER BY GESAMTPREIS DESC
	FETCH FIRST 1 ROW ONLY;

--A 2.10
CREATE VIEW KundenUmsatz AS
	SELECT k.NAME, SUM(a.GESAMTPREIS)AS GESAMTPREIS  FROM KUNDE k
	INNER JOIN AUFTRAG a2 ON k.NR = a2.KUNDNR
	INNER JOIN AUFTRAGSPOSTEN a ON a2.AUFTRNR = a.AUFTRNR
	GROUP BY k.NAME;
SELECT * FROM KundenUmsatz;

--A 2.11
DROP VIEW KundenUmsatz;

--A 3.0

COMMIT;

SELECT COUNT(*) FROM LIEFERUNG;
DELETE LIEFERANT;
SELECT COUNT(*) FROM LIEFERUNG;

ROLLBACK;

SELECT COUNT(*) FROM LIEFERUNG;



